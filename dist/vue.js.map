{"version":3,"file":"vue.js","sources":["../src/observe/observe.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["\r\nclass Observer {\r\n    constructor(data) {\r\n        // Object.defineProperty只能劫持已经存在的属性\r\n        this.walk(data)\r\n    }\r\n    walk(data) { // 循环对象，对属性依次劫持\r\n        // 重新定义属性\r\n        Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\r\n    }\r\n}\r\n\r\nexport function defineReactive(target, key, value) { // 闭包 属性劫持\r\n    observe(value) // 对所有属性进行劫持\r\n    Object.defineProperty(target, key, {\r\n        get() { // 取值的时候会执行get\r\n            console.log('用户取值了')\r\n            return value\r\n        },\r\n        set(newValue) { // 修改的时候会执行set\r\n            console.log('用户设置值了')\r\n            if(newValue === value) return\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data) {\r\n    // 劫持对象\r\n    if (typeof data !== 'object' || data == null) {\r\n        return // 只对对象劫持\r\n    }\r\n    // console.log(data)\r\n\r\n    /*\r\n        如果一个对象被劫持过，那就不需要再被劫持（要判断一个对象是否被劫持过，\r\n        可以增添一个实例，用实例来判断是否被劫持）\r\n    */\r\n\r\n    return new Observer(data)\r\n}","\r\nimport { observe } from \"./observe/observe\"\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options // 获取所有的选项\r\n    if(opts.data) {\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n    Object.defineProperty(vm, key, { // vm.name\r\n        get() {\r\n            return vm[target][key] //vm._data.name\r\n        },\r\n        set(newValue) {\r\n            vm[target][key] = newValue\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data // data可能是函数和对象\r\n    data = typeof data === 'function' ? data.call(vm) : data\r\n    // console.log(data)\r\n\r\n    // 对数据进行劫持 vue2 里采用了一个api defineProperty\r\n    vm._data = data\r\n    observe(data)\r\n\r\n    // 将vm._data用vm来代理就可以\r\n    for(let key in data) {\r\n        proxy(vm, '_data', key)\r\n    }\r\n    \r\n}","\r\nimport { initState } from \"./state\"\r\nexport function initMixin(Vue) { // 给Vue增加init方法\r\n    Vue.prototype._init = function(options) { // 初始化操作\r\n        const vm = this\r\n        vm.$options = options // 将用户的选项挂载到实例上\r\n\r\n        // 初始化状态\r\n        initState(vm)\r\n    }\r\n}\r\n","import { initMixin } from \"./init\"\r\n\r\n// 将所有的方法都耦合在一起\r\nfunction Vue(options) {  // options用户的选项\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["Observer","data","walk","Object","keys","forEach","key","defineReactive","target","value","observe","defineProperty","get","console","log","set","newValue","initState","vm","opts","$options","initData","proxy","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}